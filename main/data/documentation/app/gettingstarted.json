{"metadata":{"role":"article","title":"Getting started","roleHeading":"Article","modules":[{"name":"App"}]},"schemaVersion":{"minor":3,"patch":0,"major":0},"hierarchy":{"paths":[["doc:\/\/App\/documentation\/App"]]},"variants":[{"paths":["\/documentation\/app\/gettingstarted"],"traits":[{"interfaceLanguage":"swift"}]}],"seeAlsoSections":[{"title":"Essentials","identifiers":["doc:\/\/App\/documentation\/App\/ConfiguringSPM","doc:\/\/App\/documentation\/App\/GithubAPI","doc:\/\/App\/documentation\/App\/Architecture","doc:\/\/App\/documentation\/App\/SpecificationSupport"],"generated":true,"anchor":"Essentials"}],"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/App\/documentation\/App\/GettingStarted"},"sections":[],"abstract":[{"text":"Learn how to build and run the Swift Package Registry Service.","type":"text"}],"primaryContentSections":[{"content":[{"level":2,"text":"Github Personal Access Token","anchor":"Github-Personal-Access-Token","type":"heading"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Many methods of the "},{"type":"reference","isActive":true,"identifier":"https:\/\/docs.github.com\/en\/rest?apiVersion=2022-11-28"},{"type":"text","text":" is accessible without authentication."},{"type":"text","text":" "},{"type":"text","text":"However, the "},{"type":"reference","isActive":true,"identifier":"https:\/\/docs.github.com\/en\/rest\/using-the-rest-api\/rate-limits-for-the-rest-api?apiVersion=2022-11-28"},{"type":"text","text":" "},{"type":"text","text":"are much lower. Therefore, it is advisable to provide the service with a"},{"type":"text","text":" "},{"type":"reference","isActive":true,"identifier":"https:\/\/docs.github.com\/en\/authentication\/keeping-your-account-and-data-secure\/managing-your-personal-access-tokens"},{"type":"text","text":" "},{"type":"text","text":"to authenticate with the Github API."}]},{"level":2,"text":"Building and running migrations","type":"heading","anchor":"Building-and-running-migrations"},{"type":"paragraph","inlineContent":[{"text":"Check out the repo and do an initial build using the ","type":"text"},{"type":"codeVoice","code":"swift"},{"text":" command line:","type":"text"}]},{"syntax":null,"type":"codeListing","code":["git clone https:\/\/github.com\/CrowdStrike\/swift-package-registry-service.git","cd swift-package-registry-service","swift build"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Now let’s set up the database which is used for parts of the disk cache:"}]},{"syntax":null,"type":"codeListing","code":["swift run App migrate"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"You should see something like:"}]},{"syntax":null,"type":"codeListing","code":["$ swift run App migrate","...","Build of product 'App' complete! (92.19s)","Migrate Command: Prepare","The following migration(s) will be prepared:","+ App.CreateRepositories on <default>","Would you like to continue?","y\/n> "]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Type ‘y’ and then hit Return. Then you should see:"}]},{"syntax":null,"type":"codeListing","code":["y\/n> y ","[ INFO ] [Migrator] Starting prepare [database-id: sqlite, migration: App.CreateRepositories]","[ INFO ] [Migrator] Finished prepare [database-id: sqlite, migration: App.CreateRepositories]","Migration successful"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Now you should see a directory created called "},{"type":"codeVoice","code":".sprsCache"},{"type":"text","text":" and a "},{"type":"codeVoice","code":"db.sqlite"},{"type":"text","text":" file inside that directory:"}]},{"syntax":null,"type":"codeListing","code":["$ ls -l .sprsCache","total 48","-rw-r--r--  1 <your-username>  staff  24576 Mar 24 14:27 db.sqlite"]},{"level":2,"text":"Running the service from the command line","type":"heading","anchor":"Running-the-service-from-the-command-line"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Now that you have created the disk cache database, then you are now ready to run the service:"}]},{"syntax":null,"type":"codeListing","code":["$ export GITHUB_API_TOKEN=\"<your-Github-PAT>\"","$ swift run App serve","Building for debugging...","...","Build of product 'App' complete! (25.07s)","[ NOTICE ] Server started on http:\/\/127.0.0.1:8080"]},{"level":2,"text":"Testing the service using curl","type":"heading","anchor":"Testing-the-service-using-curl"},{"type":"paragraph","inlineContent":[{"text":"Before you point Swift Package Manager at this service, you might want to do some simple curl’s to see it run.","type":"text"},{"text":" ","type":"text"},{"text":"All of the examples below use ","type":"text"},{"identifier":"https:\/\/github.com\/pointfreeco\/swift-overture","type":"reference","isActive":true},{"text":" as an example.","type":"text"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"The sections below give examples of each of the 5 endpoints of the service."}]},{"level":3,"text":"List Package Releases using curl","type":"heading","anchor":"List-Package-Releases-using-curl"},{"syntax":null,"type":"codeListing","code":["$ curl --no-progress-meter -H \"Accept: application\/vnd.swift.registry.v1+json\" http:\/\/127.0.0.1:8080\/pointfreeco\/swift-overture","{","  \"releases\" : {","    \"0.1.0\" : {","      \"url\" : \"http:\/\/127.0.0.1:8080\/pointfreeco\/swift-overture\/0.1.0\"","    },","    \"0.2.0\" : {","      \"url\" : \"http:\/\/127.0.0.1:8080\/pointfreeco\/swift-overture\/0.2.0\"","    },","    \"0.3.0\" : {","      \"url\" : \"http:\/\/127.0.0.1:8080\/pointfreeco\/swift-overture\/0.3.0\"","    },","    \"0.3.1\" : {","      \"url\" : \"http:\/\/127.0.0.1:8080\/pointfreeco\/swift-overture\/0.3.1\"","    },","    \"0.4.0\" : {","      \"url\" : \"http:\/\/127.0.0.1:8080\/pointfreeco\/swift-overture\/0.4.0\"","    },","    \"0.5.0\" : {","      \"url\" : \"http:\/\/127.0.0.1:8080\/pointfreeco\/swift-overture\/0.5.0\"","    }","  }","}"]},{"level":3,"text":"Fetch release metadata using curl","type":"heading","anchor":"Fetch-release-metadata-using-curl"},{"syntax":null,"type":"codeListing","code":["$ curl --no-progress-meter -H \"Accept: application\/vnd.swift.registry.v1+json\" http:\/\/127.0.0.1:8080\/pointfreeco\/swift-overture\/0.5.0","{","  \"id\" : \"pointfreeco.swift-overture\",","  \"metadata\" : {","    \"repositoryURLs\" : [","      \"https:\/\/github.com\/pointfreeco\/swift-overture\",","      \"https:\/\/github.com\/pointfreeco\/swift-overture.git\",","      \"git@github.com:pointfreeco\/swift-overture.git\"","    ]","  },","  \"publishedAt\" : \"2019-03-26T18:04:46Z\",","  \"resources\" : [","    {","      \"checksum\" : \"13aedbe3a79154ef848290444ac754c5cf9fee9283f46a3a43645004a912063f\",","      \"name\" : \"source-archive\",","      \"type\" : \"application\/zip\"","    }","  ],","  \"version\" : \"0.5.0\"","}"]},{"level":3,"text":"Fetch manifest using curl","type":"heading","anchor":"Fetch-manifest-using-curl"},{"syntax":null,"type":"codeListing","code":["$ curl --verbose -H \"Accept: application\/vnd.swift.registry.v1+swift\" http:\/\/127.0.0.1:8080\/pointfreeco\/swift-overture\/0.5.0\/Package.swift","\/\/ swift-tools-version:5.0","import Foundation","import PackageDescription","","let package = Package(","  name: \"Overture\",","  products: [","    .library(","      name: \"Overture\",","      targets: [\"Overture\"]),","  ],","  targets: [","    .target(","      name: \"Overture\",","      dependencies: []),","    .testTarget(","      name: \"OvertureTests\",","      dependencies: [\"Overture\"]),","  ]",")","","if ProcessInfo.processInfo.environment.keys.contains(\"PF_DEVELOP\") {","  package.dependencies.append(","    contentsOf: [","      .package(url: \"https:\/\/github.com\/yonaskolb\/XcodeGen.git\", from: \"2.3.0\"),","    ]","  )","}"]},{"level":3,"text":"Download Source Archive via curl","type":"heading","anchor":"Download-Source-Archive-via-curl"},{"syntax":null,"type":"codeListing","code":["$ curl --no-progress-meter -H \"Accept: application\/vnd.swift.registry.v1+zip\" --output swift-overture-0.5.0.zip http:\/\/127.0.0.1:8080\/pointfreeco\/swift-overture\/0.5.0.zip"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"After running you should see a file called "},{"code":"swift-overture-0.5.0.zip","type":"codeVoice"},{"type":"text","text":"."}]},{"level":3,"text":"Lookup Package Identifiers via curl","type":"heading","anchor":"Lookup-Package-Identifiers-via-curl"},{"syntax":null,"type":"codeListing","code":["$ curl --no-progress-meter -H \"Accept: application\/vnd.swift.registry.v1+json\" \"http:\/\/127.0.0.1:8080\/identifiers?url=https:\/\/github.com\/pointfreeco\/swift-overture.git\"","{","  \"identifiers\" : [","    \"pointfreeco.swift-overture\"","  ]","}"]},{"level":2,"text":"Building and Running Using Xcode","type":"heading","anchor":"Building-and-Running-Using-Xcode"},{"type":"paragraph","inlineContent":[{"text":"If you want to run and debug the service using Xcode, first do the “Building and running migrations” step above, then do the following:","type":"text"}]},{"items":[{"content":[{"inlineContent":[{"text":"In Xcode, do File\/Open and open the ","type":"text"},{"code":"Package.swift","type":"codeVoice"},{"text":" in this repository. Allow package resolution to finish.","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Make sure that the target build device is “My Mac”.","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"Click on the ","type":"text"},{"type":"codeVoice","code":"swift-package-registry-service"},{"text":" scheme and choose “Edit Scheme”.","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Choose the “Run” action in the left-hand pane."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Choose the “Arguments” tab in the top-center."}]}]},{"content":[{"inlineContent":[{"type":"text","text":"In the “Environment Variables” section, click the “+” button."}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Name the new environment variable "},{"type":"codeVoice","code":"GITHUB_API_TOKEN"},{"type":"text","text":"."}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Set the value of ","type":"text"},{"code":"GITHUB_API_TOKEN","type":"codeVoice"},{"text":" to be your Github Personal Access Token.","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Choose the “Options” tab in the top-center."}]}]},{"content":[{"inlineContent":[{"text":"Select the checkbox beside “Use custom working directory” and choose the directory where you cloned the repository.","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Choose Close in the bottom right to finish editing the "},{"code":"swift-package-registry-service","type":"codeVoice"},{"type":"text","text":" scheme."}]}]},{"content":[{"inlineContent":[{"text":"Click the Play button in the upper-left to Build and Run.","type":"text"}],"type":"paragraph"}]}],"type":"orderedList"},{"type":"paragraph","inlineContent":[{"text":"Once the build has succeeded and the server started, you should see something like this in the Xcode console:","type":"text"}]},{"syntax":null,"type":"codeListing","code":["[ NOTICE ] Server started on http:\/\/127.0.0.1:8080"]},{"type":"paragraph","inlineContent":[{"text":"If you see a message something like this in the Xcode console:","type":"text"}]},{"syntax":null,"type":"codeListing","code":["[ WARNING ] No custom working directory set for this scheme, using \/Users\/<your-username>\/Library\/Developer\/Xcode\/DerivedData\/swift-package-registry-service-github-bwqdugfplzkkyueszneqimmdhxqo\/Build\/Products\/Debug (Vapor\/DirectoryConfiguration.swift:57)"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"then you have forgotten to set the Custom Working Directory in Step 10 above."}]},{"level":2,"text":"Changing the logging level","type":"heading","anchor":"Changing-the-logging-level"},{"type":"paragraph","inlineContent":[{"type":"text","text":"The Vapor log levels are:"}]},{"items":[{"content":[{"inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Trace"}]},{"type":"text","text":": Messages that contain information normally of use only when tracing the execution of a program."}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"inlineContent":[{"text":"Debug","type":"text"}],"type":"strong"},{"text":": Messages that contain information normally of use only when debugging a program.","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"inlineContent":[{"type":"text","text":"Info"}],"type":"strong"},{"text":": Informational messages.","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"inlineContent":[{"text":"Notice","type":"text"}],"type":"strong"},{"text":": Conditions that are not error conditions, but that may require special handling.","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"inlineContent":[{"text":"Warning","type":"text"}],"type":"strong"},{"text":": Messages that are not error conditions, but more severe than Notice.","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"inlineContent":[{"text":"Error","type":"text"}],"type":"strong"},{"text":": Error conditions.","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Critical"}]},{"type":"text","text":": Critical error conditions that usually require immediate attention."}]}]}],"type":"unorderedList"},{"type":"paragraph","inlineContent":[{"type":"text","text":"The default Vapor logging level is Info. If you want to change the logging level, see the"},{"type":"text","text":" "},{"type":"text","text":"instructions below."}]},{"level":3,"text":"Using Xcode","type":"heading","anchor":"Using-Xcode"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Click the ","type":"text"},{"code":"swift-package-registry-service","type":"codeVoice"},{"text":" scheme.","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"Click Edit Scheme.","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Click the Run action in the left pane."}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Click the Arguments tab in the top middle."}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Add a "},{"type":"codeVoice","code":"--log <log-level>"},{"type":"text","text":" argument, where "},{"type":"codeVoice","code":"<log-level>"},{"type":"text","text":" is "},{"type":"codeVoice","code":"trace"},{"type":"text","text":", "},{"type":"codeVoice","code":"debug"},{"type":"text","text":", "},{"type":"codeVoice","code":"info"},{"type":"text","text":", "},{"type":"codeVoice","code":"notice"},{"type":"text","text":","},{"type":"text","text":" "},{"type":"codeVoice","code":"warning"},{"type":"text","text":", "},{"type":"codeVoice","code":"error"},{"type":"text","text":", or "},{"type":"codeVoice","code":"critical"},{"type":"text","text":"."}]}]}],"type":"orderedList"},{"level":3,"text":"Using swift command line","type":"heading","anchor":"Using-swift-command-line"},{"type":"paragraph","inlineContent":[{"text":"Add a ","type":"text"},{"code":"--log <log-level>","type":"codeVoice"},{"text":" to your ","type":"text"},{"code":"swift run","type":"codeVoice"},{"text":" command, where ","type":"text"},{"code":"<log-level>","type":"codeVoice"},{"text":" is ","type":"text"},{"code":"trace","type":"codeVoice"},{"text":",","type":"text"},{"text":" ","type":"text"},{"code":"debug","type":"codeVoice"},{"text":", ","type":"text"},{"code":"info","type":"codeVoice"},{"text":", ","type":"text"},{"code":"notice","type":"codeVoice"},{"text":", ","type":"text"},{"code":"warning","type":"codeVoice"},{"text":", ","type":"text"},{"code":"error","type":"codeVoice"},{"text":", or ","type":"text"},{"code":"critical","type":"codeVoice"},{"text":". For example, to set ","type":"text"},{"code":"debug","type":"codeVoice"},{"text":"-level logging:","type":"text"}]},{"syntax":null,"type":"codeListing","code":["swift run --log debug"]}],"kind":"content"}],"kind":"article","references":{"https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens":{"titleInlineContent":[{"text":"Github Personal Access Token (PAT)","type":"text"}],"type":"link","url":"https:\/\/docs.github.com\/en\/authentication\/keeping-your-account-and-data-secure\/managing-your-personal-access-tokens","title":"Github Personal Access Token (PAT)","identifier":"https:\/\/docs.github.com\/en\/authentication\/keeping-your-account-and-data-secure\/managing-your-personal-access-tokens"},"doc://App/documentation/App/GithubAPI":{"role":"article","type":"topic","kind":"article","abstract":[{"text":"We can implement a Swift Package Registry Service by using these four operations in the Github API:","type":"text"}],"identifier":"doc:\/\/App\/documentation\/App\/GithubAPI","url":"\/documentation\/app\/githubapi","title":"Github API"},"doc://App/documentation/App/SpecificationSupport":{"title":"Specification Support","type":"topic","abstract":[{"text":"See the status of each feature in the Swift Package Registry Service specification.","type":"text"}],"identifier":"doc:\/\/App\/documentation\/App\/SpecificationSupport","role":"article","kind":"article","url":"\/documentation\/app\/specificationsupport"},"doc://App/documentation/App/Architecture":{"abstract":[{"text":"This article describes the architecture of the Swift Package Registry Service.","type":"text"}],"title":"Architecture","role":"article","kind":"article","type":"topic","identifier":"doc:\/\/App\/documentation\/App\/Architecture","url":"\/documentation\/app\/architecture"},"doc://App/documentation/App":{"title":"App","url":"\/documentation\/app","role":"collection","kind":"symbol","identifier":"doc:\/\/App\/documentation\/App","abstract":[{"type":"text","text":"The Swift Package Registry Service is a Vapor-based web service which implements the Swift Package Registry Service Specification by proxying and caching the Github API."}],"type":"topic"},"https://docs.github.com/en/rest/using-the-rest-api/rate-limits-for-the-rest-api?apiVersion=2022-11-28":{"titleInlineContent":[{"type":"text","text":"rate limits"}],"type":"link","url":"https:\/\/docs.github.com\/en\/rest\/using-the-rest-api\/rate-limits-for-the-rest-api?apiVersion=2022-11-28","title":"rate limits","identifier":"https:\/\/docs.github.com\/en\/rest\/using-the-rest-api\/rate-limits-for-the-rest-api?apiVersion=2022-11-28"},"https://github.com/pointfreeco/swift-overture":{"titleInlineContent":[{"text":"this repository","type":"text"}],"type":"link","url":"https:\/\/github.com\/pointfreeco\/swift-overture","title":"this repository","identifier":"https:\/\/github.com\/pointfreeco\/swift-overture"},"doc://App/documentation/App/ConfiguringSPM":{"type":"topic","kind":"article","abstract":[{"text":"Learn how to configure your Swift Package Manager to use the package registry.","type":"text"}],"role":"article","title":"Configuring Swift Package Manager","identifier":"doc:\/\/App\/documentation\/App\/ConfiguringSPM","url":"\/documentation\/app\/configuringspm"},"https://docs.github.com/en/rest?apiVersion=2022-11-28":{"titleInlineContent":[{"type":"text","text":"Github API"}],"type":"link","url":"https:\/\/docs.github.com\/en\/rest?apiVersion=2022-11-28","title":"Github API","identifier":"https:\/\/docs.github.com\/en\/rest?apiVersion=2022-11-28"}}}